# 2025-11-19 – Journal – Phase 1 Implementation

## 09:05 – Session Kickoff
- Re-read HLD/plan plus latest context to confirm Phase 1 goals.
- Catalogued outstanding items: asset extractor docs/tests, fixture integration, driver DB wiring, telemetry capture, DOS capture prep docs.
- Established working plan prioritizing documentation + runtime hooks before deeper tooling.

## 10:20 – Data plumbing updates
- Swapped `GameState` to load the sanitized driver DB from disk (env overrides via `F1GP_DRIVER_DB_PATH`) with logging + fallback.
- Added telemetry capture plumbing: runtime now records player/AI samples every frame and flushes to `telemetry/*.bin` when races finish, when tracks change, or on shutdown; env var `F1GP_TELEMETRY` toggles capture; gitignore updated.
- Wrote helper doc `docs/data_pipeline.md` covering the asset workflow, fixtures, driver DB configuration, telemetry outputs, and DOS capture prep so the plan is actionable for the rest of Phase 1.

## 11:05 – Tooling + fixtures hardening
- Expanded `data/fixtures/README.md` with generation/CI instructions and made fixture regeneration script the documented path.
- Added `tools/asset_extractor` integration tests using synthetic track fixtures to guard the checksum/manifest flow.
- Updated README with a "Data & Asset Workflow" section (asset extractor usage, fixture generation, driver DB env var, telemetry toggle) to steer contributors to the new pipeline docs.

## 12:10 – Audio/UI extractor implementation
- Added new workspace tool `tools/audio_ui_extractor`: `pcm` subcommand converts unsigned 8-bit PCM blobs into WAVs, emits SHA-256 manifest entries, and is covered by fixture-based tests; `font` subcommand turns 1bpp packed glyph binaries into PNG atlases with optional glyph metadata.
- Documented the workflow in README + `docs/data_pipeline.md`, calling out how to run the converter and where manifests/live assets should sit for provenance.
- All workspace tests (main crate + new tool) pass locally.

## 12:45 – CI + fixtures workflow
- Added `scripts/run_ci.sh` that rebuilds sanitized fixtures, checks formatting, runs Clippy with `-D warnings`, and executes the full workspace test suite so local runs match CI expectations.
- Surfaced the script in README + CONTRIBUTING and noted it in `docs/data_pipeline.md` to close the "fixtures + CI" gap from the Phase 1 plan.

## 13:10 – Telemetry tooling & spec
- Created `tools/telemetry_cli` with `summary`, `export-json`, and `export-csv` subcommands so telemetry captures can be inspected or converted without custom scripts; added basic unit coverage.
- Authored `wrk_docs/2025.11.19 - Telemetry Schema Spec.md` to document the binary layout, units, and acceptance criteria for task 1.7.
- Updated README + `docs/data_pipeline.md` to reference the new CLI and link to the schema doc so parity workflows have clear guidance.

## 13:40 – DOS capture playbook + telemetry fixtures
- Authored `docs/dos_capture_playbook.md` with cycle settings, manifest requirements, and parity checklist to satisfy task 1.8.
- Extended `generate_fixtures` to emit a synthetic telemetry capture under `data/fixtures/telemetry/`, updated fixture docs/README references, and linked the playbook from README + pipeline guide.
- Ran `cargo test -p f1gp-port` to ensure the new fixture code compiles and existing suites remain green.

## 14:05 – Telemetry parity harness stub
- Added `telemetry_cli diff` subcommand (with CSV reader + avg speed delta metric) and documented its use in the parity harness guide; removed the temporary standalone script.
- Created `docs/parity_harness.md` outlining the workflow and synthetic fixture validation flow; README/data pipeline now reference the CLI diff usage.
- Generated sanitized telemetry CSV fixtures via `scripts/generate_fixture_csvs.sh` so CI/tests can exercise the diff without proprietary captures.

## 14:30 – Phase 1 wrap status
- Drafted `wrk_docs/2025.11.19 - STATUS - Phase 1 Wrap-Up.md` outlining completed deliverables, outstanding tasks (racing-line schema, CI integration, DOS automation), and next actions before Phase 2.
- Catalogued remaining TODO hot spots (sprite rendering, racing-line exports, HUD deltas) to steer upcoming implementation work.

## 15:00 – Racing line exporter
- Created `tools/racing_line_cli` with `summary` and `export` modes to dump section + racing line metadata (JSON) from DAT files; includes fixture-backed serialization test.
- Updated README/data pipeline guidance so contributors know how to run the exporter alongside the asset/telemetry tooling.
- Verified the new crate via `cargo test -p racing_line_cli`.

## 15:20 – Racing-line schema doc
- Authored `wrk_docs/2025.11.19 - Racing Line Schema.md` describing the JSON contract emitted by `racing_line_cli` (section/racing-line fields, usage steps, future extensions).
- Updated README to reference the schema doc so consumers know where to find field definitions.

## 15:35 – CI parity check
- Updated `scripts/run_ci.sh` to run the telemetry fixture CSV generator and a `telemetry_cli diff` self-check so CI verifies the parity tooling before running fmt/clippy/tests.

## 16:00 – DOS capture parser
- Created `tools/dos_capture_parser` with CSV/JSON exporters and a simple parser for the DOS serial log format (`timestamp|CAR=xx|SPD=...`). Added fixture-based unit test for line parsing.
- Verified the new CLI via `cargo test -p dos_capture_parser` and added a quick manual run to confirm empty logs are handled.

## 16:15 – DOS parser docs
- Linked the new `dos_capture_parser` CLI into README, the data pipeline, and the DOS capture playbook so Task 1.8 now has end-to-end instructions (capture -> parser -> telemetry diff).

## 16:30 – Audio/UI extractor doc
- Added `docs/audio_ui_extractor.md` detailing PCM + font conversion commands and manifest expectations; updated README to reference it so contributors know where to find the full workflow.

## 17:00 – Sprite atlas tooling
- Created `tools/sprite_atlas_cli` with `pack` + `generate-fixtures` subcommands, PNG atlas output, and manifest JSON for sanitized sprites; tests cover fixture generation.
- Documented usage in README and data pipeline (Phase 2 preview), ensuring placeholder sprites can be generated without proprietary assets.

## 17:20 – Sprite fixture automation
- Added `scripts/generate_sprite_fixtures.sh` to produce sanitized placeholder sprites plus an atlas/manifest (git-ignored) and wired it into `scripts/run_ci.sh` so CI consistently exercises the sprite pipeline.
- README/data pipeline now reference the script to keep instructions centralized.

## 17:40 – Sprite atlas loader integration
- Added `render::sprite_atlas` module with manifest loader + tests, plus `CarRenderer` plumbing (optional atlas + bounding-box placeholder) to prep for Phase 2 sprite work.
- Updated workspace dev deps with `tempfile` for loader tests and re-exported the atlas API from `render::mod`.
- `cargo test -p f1gp-port` now covers the new loader.

## 17:55 – Game renderer wiring
- Hooked `CarRenderer` into the new `SpriteAtlas` loader; `GameState` now auto-loads the sanitized fixture atlas when present so future work can render actual sprites.
- Added helper constructors (`with_sprite_atlas`, `set_sprite_atlas`) and confirmed the atlas module exports through `render::mod`.
- `cargo test -p f1gp-port` still passes.

## 18:15 – SDL sprite rendering bridge
- Extended the renderer trait/SDL backend with `draw_rgba_region`, added `SpriteSheet` loader, and updated `CarRenderer`/`GameState` to load the fixture atlas PNG so cars now render using atlas frame dimensions (rotated placeholders drawn via the atlas texture rather than abstract circles when the sanitized sprite sheet exists).
- Added `image` + `tempfile` workspace dependencies; all tests pass (`cargo test -p f1gp-port`).

## 19:05 – Sprite texture caching
- Added a sprite texture cache inside `SdlRenderer` keyed by atlas manifest path (`SpriteSheet::cache_key()`), avoiding per-frame SDL texture uploads.
- Renderer trait now accepts a cache key for `draw_rgba_region`; `CarRenderer` passes the sheet key so cached textures reuse atlas data.
- All tests remain green (`cargo test -p f1gp-port`).
