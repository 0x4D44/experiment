# 3D Demo Enhancement Plan

**Date:** 2025-11-16
**Status:** Planning → Implementation

## Overview

Enhance the 3D demo (tools/3d_demo) with critical features to make it a fully functional racing game demo. Focus on immediate value and user experience.

## Phase 1: Core Enhancements (High Priority)

### 1.1 HUD Overlay (Est: 1 hour)
**Goal:** Display real-time telemetry over the 3D scene

**Features:**
- Speed (km/h)
- Current gear
- Engine RPM
- Lap time (current)
- Best lap time
- Current lap number
- Position indicator
- Camera mode indicator

**Implementation:**
- Use wgpu_glyph or similar for text rendering
- Render after 3D scene, no depth testing
- Semi-transparent background panels
- Color coding (green on track, red off track)

**Technical:**
- Add font rendering dependency (e.g., wgpu_glyph, egui, or imgui-wgpu)
- Create HUD render pass (no depth buffer)
- Position elements: top-left (telemetry), top-right (timing), bottom (controls help)

### 1.2 Audio Integration (Est: 1 hour)
**Goal:** Connect audio engine for immersive racing sounds

**Features:**
- Engine sound (pitch varies with RPM)
- Tire screech (when sliding)
- Gear shift sounds
- Wind noise (speed-based)
- Kerb rumble
- Collision sounds

**Implementation:**
- Enable audio feature flag
- Create AudioEngine in App struct
- Update sounds in render loop based on car state
- Map RPM → engine pitch
- Map slip ratio → tire screech volume
- Trigger one-shots on gear changes

**Technical:**
- Conditional compilation with #[cfg(feature = "audio")]
- Update Cargo.toml to enable audio feature
- Use existing SoundSource builders from audio/sound.rs

### 1.3 Performance Metrics (Est: 0.5 hours)
**Goal:** Detailed performance monitoring and optimization

**Features:**
- Frame time graph (last 60 frames)
- Average/min/max FPS
- Update time vs render time breakdown
- GPU frame time (if available)
- Memory usage
- Triangle count display

**Implementation:**
- Ring buffer for frame time history
- Toggle display with F3 key
- Render as overlay (similar to HUD)
- Color-coded warnings (red if < 60 FPS)

## Phase 2: Polish & Features (Medium Priority)

### 2.1 Enhanced Camera Controls (Est: 0.5 hours)
**Goal:** More control over camera positioning

**Features:**
- Free camera mode (F key)
- Manual camera rotation (mouse drag)
- Zoom control (mouse wheel)
- Reset camera (Home key)
- Smooth camera interpolation improvements

**Implementation:**
- Add mouse input handling to winit events
- New CameraMode::Free variant
- Manual position/target offsets
- Smooth transitions between modes

### 2.2 Visual Improvements (Est: 1 hour)
**Goal:** Better graphics quality

**Features:**
- Improved lighting (sun position control)
- Shadows (simple shadow mapping)
- Particle effects (dust, tire smoke)
- Track-side objects (barriers, grandstands)
- Better skybox (gradient + clouds)

**Implementation:**
- Shadow map texture + render pass
- Particle system using instanced rendering
- Simple object models for trackside details
- Enhanced skybox shader with cloud noise

### 2.3 Replay System (Est: 1.5 hours)
**Goal:** Record and playback races

**Features:**
- Record car positions/orientations
- Playback with camera control
- Save/load replay files
- Speed control (pause, slow-mo, fast-forward)

**Implementation:**
- Record transform history in ring buffer
- Serialize to file (bincode)
- Playback mode in game state
- Time manipulation controls

## Phase 3: Content & Extensibility (Lower Priority)

### 3.1 Real Track Support (Est: 2 hours)
**Goal:** Load actual F1GP track data

**Features:**
- Load .TRK files from F1GP
- Parse track sections, objects, cameras
- Generate proper 3D meshes
- AI racing line visualization

**Implementation:**
- Use existing track parser from data/track.rs
- Enhance TrackMesh::from_track() for complex geometry
- Add track objects as separate meshes
- Display AI racing line as overlay

### 3.2 Multi-Track Menu (Est: 1 hour)
**Goal:** Allow track selection

**Features:**
- Track selection menu
- Preview thumbnails
- Track info (name, length, lap record)
- Quick restart on same track

**Implementation:**
- Simple UI menu system
- Track metadata structure
- Track file enumeration
- Menu navigation with keyboard

### 3.3 Configuration System (Est: 0.5 hours)
**Goal:** Customizable settings

**Features:**
- Graphics settings (resolution, vsync, quality)
- Audio volume controls
- Control key bindings
- Save/load config file

**Implementation:**
- Config struct with serde
- TOML config file
- Settings menu UI
- Apply settings at runtime

## Phase 4: Advanced Features (Future)

### 4.1 Multiplayer Support (Est: 8+ hours)
- Network synchronization
- Lobby system
- Collision resolution
- Latency compensation

### 4.2 Advanced Physics (Est: 4 hours)
- Suspension simulation
- Tire temperature/wear
- Fuel consumption
- Weather effects (rain)

### 4.3 Career Mode (Est: 10+ hours)
- Championship points
- Season progression
- Car upgrades
- Sponsor contracts

## Implementation Priority

**Immediate (This Session):**
1. HUD Overlay ⭐⭐⭐
2. Audio Integration ⭐⭐⭐
3. Performance Metrics ⭐⭐

**Next Session:**
4. Enhanced Camera Controls ⭐⭐
5. Visual Improvements ⭐
6. Real Track Support ⭐⭐

**Future:**
7. Replay System
8. Multi-Track Menu
9. Configuration System
10. Advanced features

## Success Criteria

**Phase 1 Complete When:**
- [ ] HUD displays speed, gear, RPM, lap time
- [ ] Audio plays engine sound with RPM variation
- [ ] Performance overlay shows FPS and frame times
- [ ] All features tested and working
- [ ] Journal updated with implementation details
- [ ] Code committed and pushed

## Technical Decisions

### Text Rendering
**Options:**
1. **wgpu_glyph** - Direct glyph rendering
2. **egui** - Immediate mode GUI (overkill but feature-rich)
3. **imgui-wgpu** - C++ imgui bindings
4. **Custom** - Simple texture-based bitmap font

**Choice:** Start with egui for rapid development, can optimize later

### Audio Feature Flag
Enable audio by default in demo, but keep it optional in library for CI/headless environments

### Performance Monitoring
Use simple ring buffer and manual timing, avoid heavy profiling dependencies

## Estimated Total Time

- Phase 1: ~2.5 hours
- Phase 2: ~3 hours
- Phase 3: ~3.5 hours
- **Total for Phases 1-3:** ~9 hours

## Next Steps

1. Implement HUD overlay with egui
2. Integrate audio engine
3. Add performance metrics
4. Test thoroughly
5. Update journal
6. Commit and push

Let's begin with Phase 1 implementation!
