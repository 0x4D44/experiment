# F1GP Reverse Engineering & Modern Rust Port - Ralph Wiggum Loop

## Mission

You are working on a clean-room reverse engineering and modern reimplementation of **Microprose Formula One Grand Prix (1996)** from DOS to Rust.

## Project Structure

- `f1gp-disasm/` - Original DOS binary artifacts (GP.EXE, extracted chunks)
- `f1gp-port/` - Modern Rust reimplementation
- `re/` - Reverse engineering toolchain (Ghidra/Binary Ninja workflows, telemetry)
- `f1gp-data/` - Extracted game data (tracks, drivers, etc.)

## Your Iterative Task

Each iteration, assess the current state and make concrete progress on ONE of these phases (in priority order):

### Phase 1: Reverse Engineering Infrastructure
**Goal:** Build tooling to systematically extract knowledge from GP.EXE

- [ ] Ensure `re/artifacts/symbols.json` is populated with known function addresses and names
- [ ] Ensure `re/artifacts/segments.yml` defines all code/data segment boundaries
- [ ] Create/update Ghidra scripts in `re/ghidra/scripts/` to export function signatures, structures, and decompiled C
- [ ] Set up telemetry capture to record original game behavior for parity testing
- [ ] Document discoveries in `re/artifacts/` (data structures, algorithms, constants)

### Phase 2: Data Format Reverse Engineering
**Goal:** Fully decode all F1GP data formats

- [ ] Track files (.TRK) - geometry, sectors, pit positions, kerbs, scenery
- [ ] Car/driver data - performance characteristics, AI behavior parameters
- [ ] Graphics formats - sprites, textures, palettes
- [ ] Sound formats - engine samples, effects, music
- [ ] Save game / championship formats
- [ ] Document each format in `f1gp-data/` with parser code and test fixtures

### Phase 3: Core Game Logic Reverse Engineering
**Goal:** Understand and document the original algorithms

Priority systems to reverse engineer:
1. **Physics engine** - car dynamics, tire grip, suspension, aerodynamics
2. **Collision detection** - car-to-car, car-to-track, car-to-barrier
3. **AI system** - racing lines, overtaking decisions, pit strategy
4. **Timing system** - lap times, sector times, race positions
5. **Weather system** - rain effects on grip, visibility, AI behavior
6. **Damage model** - component damage, performance degradation

For each system:
- Extract constants and magic numbers from GP.EXE
- Document the algorithm in pseudocode
- Create test cases from original game telemetry

### Phase 4: Rust Implementation
**Goal:** Complete the modern port in `f1gp-port/`

Check `f1gp-port/src/` for existing implementation. Extend it to include:

- [ ] All track features (verified against original .TRK parsing)
- [ ] Accurate physics (validated against original telemetry)
- [ ] Full AI system (26 cars racing competitively)
- [ ] Complete race weekend (practice, qualifying, race)
- [ ] Championship mode (full season with points)
- [ ] All original tracks (16 circuits)
- [ ] Pit stops and tire strategy
- [ ] Damage and mechanical failures
- [ ] Weather effects (rain racing)
- [ ] Authentic audio (engine, effects, ambient)
- [ ] Period-accurate 2.5D rendering style

### Phase 5: Parity Testing
**Goal:** Verify the Rust port matches original behavior

- [ ] Capture deterministic traces from original DOS game
- [ ] Replay same inputs in Rust port
- [ ] Compare physics state frame-by-frame
- [ ] Document and fix discrepancies
- [ ] Build regression test suite

## How to Work Each Iteration

1. **Assess** - Check git status, recent commits, TODO comments, and test results
2. **Pick ONE task** - Choose the highest-priority incomplete task you can make progress on
3. **Execute** - Do the work: write code, run analysis, update documentation
4. **Test** - Run `cargo test` in f1gp-port, verify your changes work
5. **Commit** - Make atomic commits with clear messages describing progress
6. **Report** - Summarize what you accomplished and what's next

## Success Criteria

The project is complete when:
- All 16 original tracks are playable
- Full 26-car AI field races competitively
- Physics feel authentic to the original
- Complete race weekend and championship modes work
- Parity tests pass against original game telemetry
- Code is clean, well-tested, and documented

## Completion Signal

When ALL success criteria are met and the game is fully playable with feature parity to the original F1GP, output:

```
<promise>F1GP PORT COMPLETE</promise>
```

## Current Session Instructions

1. First, explore the current state of all project directories
2. Check git log for recent progress
3. Run existing tests to see what's passing/failing
4. Identify the most impactful task you can complete this iteration
5. Do the work and commit your progress
6. If blocked, document what's needed and move to another task

Remember: Each iteration should produce tangible, committed progress. Small steps compound into a complete game.
