# jrnrvw - Journal Review Tool Specification

**Version:** 1.0
**Date:** 2025.11.13
**Language:** Rust
**Interface:** Command Line Interface (CLI)

## 1. Overview

`jrnrvw` (Journal Review) is a command-line tool designed to find, parse, and analyze task journal files within a directory tree. The tool helps developers and project managers review work activities, track progress across repositories, and generate reports on task completion and time allocation.

## 2. Purpose

The primary purpose of `jrnrvw` is to:
- Discover journal files following a specific naming convention
- Parse and extract structured information from journal entries
- Group work activities by repository and task
- Provide time-based filtering and analysis
- Generate comprehensive reports on work performed

## 3. Journal File Format

### 3.1 File Naming Convention
Journal files follow the pattern:
```
yyyy.mm.dd - JRN - <description>.md
```

**Examples:**
- `2025.11.13 - JRN - authentication implementation.md`
- `2025.11.12 - JRN - bug fixes and refactoring.md`
- `2025.11.10 - JRN - sprint planning.md`

### 3.2 File Location
- Journal files can be located anywhere in the directory tree below the search root
- Commonly organized in subdirectories (e.g., `wrk_jrn/`, `journals/`, or project-specific directories)
- The tool performs recursive search from the specified starting directory

### 3.3 Expected File Structure
Journal files are markdown documents with the following typical structure:
```markdown
# yyyy.mm.dd - Journal: <Title>

## Task
<Task description>

## Repo/Project
<Repository or project name>

## Activities
- Activity 1
- Activity 2

## Notes
<Additional notes>

## Time Spent
<Optional time tracking>
```

## 4. Core Features

### 4.1 File Discovery
- Recursively scan directory tree from current or specified directory
- Match files using the journal naming pattern
- Support for case-insensitive matching
- Exclude common ignore patterns (.git/, node_modules/, target/, etc.)

### 4.2 Parsing and Extraction
- Parse markdown structure
- Extract key metadata:
  - Date from filename
  - Task/project identifiers
  - Repository information
  - Activities and notes
  - Time spent (if present)
- Handle variations in journal structure gracefully

### 4.3 Grouping and Organization
Primary grouping hierarchy:
1. **By Repository** - Group all work by repository/project
2. **By Task** - Within each repository, group by task/feature

Secondary grouping options:
- By date
- By time period (week, month)
- By author (if multi-user journals)

### 4.4 Time Range Filtering

#### Predefined Ranges
- `--last-week`: Last 7 calendar days
- `--last-month`: Last 30 calendar days
- `--this-week`: Current calendar week (Monday-Sunday)
- `--this-month`: Current calendar month
- `--activity-days <N>`: Last N days of actual activity (ignoring gaps)

#### Custom Ranges
- `--from <date>`: Start date (format: yyyy-mm-dd)
- `--to <date>`: End date (format: yyyy-mm-dd)
- `--since <date>`: All entries since date (inclusive)
- `--before <date>`: All entries before date (exclusive)

#### Activity-Based Filtering
- `--activity-window <N>`: Last N days that have journal entries (skip gaps)
- Example: If journals exist on days 1, 5, 10, 15, and `--activity-window 3` is specified, include only days 10 and 15

### 4.5 Output Formats
- **Text**: Human-readable console output (default)
- **Markdown**: Formatted markdown report
- **JSON**: Structured data for programmatic consumption
- **HTML**: Standalone HTML report with styling
- **CSV**: Tabular data for spreadsheet analysis

## 5. Command Line Interface

### 5.1 Basic Usage
```bash
# Analyze all journals in current directory tree
jrnrvw

# Analyze with specific root directory
jrnrvw /path/to/projects

# Analyze last week
jrnrvw --last-week

# Analyze last 7 days of activity
jrnrvw --activity-days 7
```

### 5.2 Command Structure
```
jrnrvw [OPTIONS] [PATH]

ARGUMENTS:
  [PATH]  Root directory to search (default: current directory)

OPTIONS:
  Time Range:
    --last-week              Last 7 calendar days
    --last-month             Last 30 calendar days
    --this-week              Current calendar week
    --this-month             Current calendar month
    --activity-days <N>      Last N days with journal entries
    --activity-window <N>    Last N days of activity (alias for --activity-days)
    --from <DATE>            Start date (yyyy-mm-dd)
    --to <DATE>              End date (yyyy-mm-dd)
    --since <DATE>           All entries since date
    --before <DATE>          All entries before date

  Filtering:
    --repo <NAME>            Filter by repository name (regex)
    --task <NAME>            Filter by task name (regex)
    --pattern <PATTERN>      Custom filename pattern (default: *.JRN.*.md)

  Grouping:
    --group-by <TYPE>        Group by: repo, task, date, week, month (default: repo)
    --sort-by <FIELD>        Sort by: date, repo, task (default: date)
    --reverse                Reverse sort order

  Output:
    -o, --output <FILE>      Output file (default: stdout)
    -f, --format <FORMAT>    Output format: text, markdown, json, html, csv (default: text)
    --no-color               Disable colored output
    --verbose, -v            Verbose output
    --quiet, -q              Minimal output

  Display Options:
    --summary                Show only summary statistics
    --detailed               Show detailed entries (default)
    --with-activities        Include activity lists
    --with-notes             Include notes sections
    --stats                  Include statistics (time, entry count, etc.)

  Other:
    -h, --help               Show help information
    -V, --version            Show version information
    --config <FILE>          Load configuration from file
```

### 5.3 Example Commands

```bash
# Last week's work, grouped by repo, markdown output
jrnrvw --last-week --format markdown -o report.md

# Last 10 days of activity in specific project
jrnrvw ~/projects/myapp --activity-days 10

# Specific date range for a particular repo
jrnrvw --from 2025-11-01 --to 2025-11-13 --repo "myproject"

# Summary statistics only
jrnrvw --last-month --summary

# JSON export for external processing
jrnrvw --format json -o journals.json

# Detailed HTML report with all sections
jrnrvw --last-week --format html --with-activities --with-notes --stats -o report.html
```

## 6. Output Format Examples

### 6.1 Text Output (Default)
```
Journal Review Report
=====================
Period: 2025-11-07 to 2025-11-13
Total Entries: 8
Repositories: 3

Repository: myapp
-----------------
  Task: Authentication Implementation
    2025-11-13 - JRN - authentication implementation.md
      - Implemented JWT token generation
      - Added password hashing with bcrypt
      - Created login endpoint

    2025-11-12 - JRN - auth bug fixes.md
      - Fixed token expiration handling
      - Updated refresh token logic

  Task: UI Refactoring
    2025-11-10 - JRN - component refactoring.md
      - Split large components into smaller ones
      - Improved state management

Repository: infrastructure
--------------------------
  Task: CI/CD Pipeline
    2025-11-09 - JRN - pipeline setup.md
      - Configured GitHub Actions
      - Added automated testing

Statistics
----------
Total entries: 8
Date range: 7 days
Active days: 4
Repositories: 3
Unique tasks: 4
```

### 6.2 JSON Output
```json
{
  "metadata": {
    "generated_at": "2025-11-13T10:30:00Z",
    "period": {
      "from": "2025-11-07",
      "to": "2025-11-13"
    },
    "total_entries": 8,
    "repositories": 3
  },
  "repositories": [
    {
      "name": "myapp",
      "path": "/home/user/projects/myapp",
      "tasks": [
        {
          "name": "Authentication Implementation",
          "entries": [
            {
              "date": "2025-11-13",
              "filename": "2025.11.13 - JRN - authentication implementation.md",
              "path": "/home/user/projects/myapp/wrk_jrn/2025.11.13 - JRN - authentication implementation.md",
              "activities": [
                "Implemented JWT token generation",
                "Added password hashing with bcrypt",
                "Created login endpoint"
              ],
              "notes": "Need to add rate limiting",
              "time_spent": "4h"
            }
          ]
        }
      ]
    }
  ],
  "statistics": {
    "total_entries": 8,
    "date_range_days": 7,
    "active_days": 4,
    "repositories": 3,
    "unique_tasks": 4
  }
}
```

## 7. Technical Architecture

### 7.1 Technology Stack
- **Language:** Rust (stable)
- **CLI Framework:** clap (v4.x) - for command-line argument parsing
- **Markdown Parsing:** pulldown-cmark - for markdown parsing
- **Date Handling:** chrono - for date/time operations
- **File Operations:** walkdir - for recursive directory traversal
- **Regex:** regex - for pattern matching
- **Serialization:** serde + serde_json - for JSON output
- **Output Formatting:**
  - colored - for colored terminal output
  - comfy-table - for table formatting
  - tera or handlebars - for HTML template rendering

### 7.2 Module Structure
```
jrnrvw/
├── src/
│   ├── main.rs              # Entry point, CLI setup
│   ├── cli.rs               # Command-line interface definitions
│   ├── discovery/
│   │   ├── mod.rs           # File discovery module
│   │   ├── scanner.rs       # Directory scanning
│   │   └── filters.rs       # File filtering logic
│   ├── parser/
│   │   ├── mod.rs           # Parser module
│   │   ├── journal.rs       # Journal file parsing
│   │   └── metadata.rs      # Metadata extraction
│   ├── analyzer/
│   │   ├── mod.rs           # Analysis module
│   │   ├── grouper.rs       # Grouping logic
│   │   ├── filter.rs        # Time range filtering
│   │   └── stats.rs         # Statistics calculation
│   ├── output/
│   │   ├── mod.rs           # Output module
│   │   ├── text.rs          # Text formatter
│   │   ├── markdown.rs      # Markdown formatter
│   │   ├── json.rs          # JSON formatter
│   │   ├── html.rs          # HTML formatter
│   │   └── csv.rs           # CSV formatter
│   ├── models/
│   │   ├── mod.rs           # Data models
│   │   ├── journal.rs       # Journal entry model
│   │   ├── repository.rs    # Repository model
│   │   └── report.rs        # Report model
│   └── config/
│       ├── mod.rs           # Configuration module
│       └── settings.rs      # Settings management
├── tests/
│   ├── integration/         # Integration tests
│   └── fixtures/            # Test journal files
├── Cargo.toml
└── README.md
```

### 7.3 Core Data Models

```rust
// Journal entry representation
pub struct JournalEntry {
    pub date: NaiveDate,
    pub filename: String,
    pub filepath: PathBuf,
    pub title: Option<String>,
    pub task: Option<String>,
    pub repository: Option<String>,
    pub activities: Vec<String>,
    pub notes: Option<String>,
    pub time_spent: Option<String>,
    pub raw_content: String,
}

// Repository grouping
pub struct Repository {
    pub name: String,
    pub path: PathBuf,
    pub tasks: Vec<Task>,
}

// Task grouping
pub struct Task {
    pub name: String,
    pub entries: Vec<JournalEntry>,
}

// Report structure
pub struct Report {
    pub metadata: ReportMetadata,
    pub repositories: Vec<Repository>,
    pub statistics: Statistics,
}
```

### 7.4 Key Algorithms

#### File Discovery Algorithm
1. Start from root directory (current or specified)
2. Recursively traverse directory tree using walkdir
3. For each file:
   - Check if filename matches pattern: `YYYY.MM.DD - JRN - *.md`
   - Validate date format
   - Skip excluded directories (.git, target, node_modules)
4. Collect all matching file paths

#### Date Extraction
1. Parse filename using regex: `^(\d{4})\.(\d{2})\.(\d{2})\s*-\s*JRN\s*-\s*(.+)\.md$`
2. Extract year, month, day
3. Validate date using chrono
4. Parse description from remaining filename

#### Repository Detection
Priority order:
1. Explicit "Repo:" or "Repository:" field in markdown
2. Git repository detection (walk up directory tree to find .git/)
3. Parent directory name if no git repo found
4. "Unknown" if no repository can be determined

#### Activity-Based Time Window
For `--activity-days N`:
1. Collect all journal entry dates
2. Sort dates in descending order
3. Take the N most recent dates
4. Filter entries matching those dates

### 7.5 Error Handling
- Graceful handling of malformed journal files
- Continue processing even if individual files fail to parse
- Collect and report parsing errors in verbose mode
- Clear error messages for invalid command-line arguments
- Handle missing permissions on directories/files

## 8. Configuration File

### 8.1 Configuration Format (TOML)
```toml
# ~/.jrnrvw.toml or .jrnrvw.toml in project root

[general]
default_path = "."
default_format = "text"
colored_output = true

[discovery]
# Custom journal filename pattern (regex)
pattern = '^\d{4}\.\d{2}\.\d{2}\s*-\s*JRN\s*-\s*.+\.md$'
# Directories to exclude from search
exclude_dirs = [".git", "node_modules", "target", "dist", "build"]
# Case-sensitive matching
case_sensitive = false

[parsing]
# Fields to extract from journal files
extract_fields = ["task", "repository", "activities", "notes", "time_spent"]
# Repository detection methods (in priority order)
repo_detection = ["explicit", "git", "parent_dir"]

[output]
# Default grouping
default_group_by = "repo"
# Default sort order
default_sort_by = "date"
# Include statistics by default
include_stats = true
# Date format for display
date_format = "%Y-%m-%d"

[time_ranges]
# Define custom time range aliases
[time_ranges.custom]
sprint = 14  # 14 days
quarter = 90  # 90 days
```

### 8.2 Configuration Priority
1. Command-line arguments (highest priority)
2. Project-level config file (`./.jrnrvw.toml`)
3. User-level config file (`~/.jrnrvw.toml`)
4. Built-in defaults (lowest priority)

## 9. Use Cases

### 9.1 Daily Work Review
**Scenario:** Developer wants to review work done today
```bash
jrnrvw --since $(date +%Y-%m-%d)
```

### 9.2 Weekly Status Report
**Scenario:** Generate weekly report for team standup
```bash
jrnrvw --this-week --format markdown -o weekly-report.md
```

### 9.3 Project Progress Tracking
**Scenario:** Review all work on specific project in last month
```bash
jrnrvw --last-month --repo "authentication-service" --with-activities
```

### 9.4 Time Analysis
**Scenario:** Understand time distribution across tasks
```bash
jrnrvw --last-month --stats --group-by task
```

### 9.5 Activity-Based Review
**Scenario:** Review last 5 days of actual work (excluding weekends/gaps)
```bash
jrnrvw --activity-days 5 --detailed
```

### 9.6 Export for External Tools
**Scenario:** Export journal data for analysis in spreadsheet
```bash
jrnrvw --last-month --format csv -o journals.csv
```

## 10. Future Enhancements

### Phase 2 Features
- Interactive TUI (Terminal User Interface) mode
- Visualization of activity over time (ASCII charts)
- Integration with git commit history
- Auto-detection of related commits for each journal entry
- Support for tags/labels in journal entries
- Full-text search across journal entries

### Phase 3 Features
- Multi-user/team journal aggregation
- Web-based dashboard for journal visualization
- Integration with project management tools (Jira, GitHub Issues)
- AI-powered task categorization and summary generation
- Time tracking integration (export to time-tracking tools)
- Automated journal templates and prompts

### Advanced Features
- Git integration: correlate journal entries with commits
- Diff view: compare work between time periods
- Trend analysis: identify patterns in work distribution
- Export to calendar formats (iCal, Google Calendar)
- Plugin system for custom parsers and formatters
- Natural language date parsing ("last Friday", "two weeks ago")

## 11. Testing Strategy

### 11.1 Unit Tests
- Date parsing from filenames
- Markdown parsing logic
- Time range filtering
- Grouping algorithms
- Repository detection
- Output formatting

### 11.2 Integration Tests
- End-to-end file discovery
- Complete parsing workflow
- Report generation with various options
- Configuration file loading
- Command-line argument processing

### 11.3 Test Fixtures
Create sample journal files with:
- Various markdown structures
- Different date ranges
- Multiple repositories
- Edge cases (malformed files, invalid dates)

### 11.4 Performance Tests
- Large directory trees (10,000+ files)
- Many journal entries (1000+ journals)
- Memory usage profiling
- Concurrent file processing

## 12. Documentation

### 12.1 User Documentation
- README.md with quick start guide
- Detailed usage examples
- Configuration guide
- Troubleshooting section
- FAQ

### 12.2 Developer Documentation
- Architecture overview
- Module documentation
- API documentation (rustdoc)
- Contributing guidelines
- Development setup guide

### 12.3 Examples
- Sample journal files
- Example configuration files
- Common use case scripts
- Output format examples

## 13. Delivery Artifacts

### 13.1 Source Code
- Complete Rust project with Cargo.toml
- All source files with documentation comments
- Unit and integration tests
- Example journal files for testing

### 13.2 Binary Distribution
- Compiled binaries for:
  - Linux (x86_64, ARM64)
  - macOS (Intel, Apple Silicon)
  - Windows (x86_64)
- Installation scripts

### 13.3 Documentation
- README.md
- User guide
- API documentation
- CHANGELOG.md

### 13.4 Package Management
- Cargo crate published to crates.io
- Homebrew formula (macOS)
- Debian package (Linux)
- AUR package (Arch Linux)
- Chocolatey package (Windows)

## 14. Success Criteria

The tool is considered successful when it:
1. Correctly identifies all journal files matching the naming pattern
2. Accurately parses journal content and extracts metadata
3. Provides intuitive and flexible time-range filtering
4. Groups entries logically by repository and task
5. Generates clear, readable reports in multiple formats
6. Handles errors gracefully without crashing
7. Performs efficiently on large directory trees (>10,000 files)
8. Provides comprehensive documentation
9. Includes thorough test coverage (>80%)
10. Offers a pleasant user experience with helpful error messages

## 15. Timeline Estimate

### Phase 1: Core Implementation (2-3 weeks)
- Week 1: File discovery, parsing, basic data models
- Week 2: Time filtering, grouping, repository detection
- Week 3: CLI interface, basic text output

### Phase 2: Output Formats (1 week)
- Markdown, JSON, HTML, CSV formatters
- Configuration file support

### Phase 3: Polish and Testing (1 week)
- Comprehensive testing
- Documentation
- Bug fixes and refinements

**Total Estimated Time:** 4-5 weeks

## 16. Open Questions

1. Should the tool support journal files in formats other than Markdown?
2. How should the tool handle very large journal files (>1MB)?
3. Should there be a limit on directory depth for scanning?
4. Should the tool support encrypted journal files?
5. How should multi-language content be handled?
6. Should there be integration with cloud storage (Dropbox, Google Drive)?

---

**Document Status:** Draft
**Next Review:** Upon implementation start
**Owner:** Development Team
